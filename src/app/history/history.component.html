<app-toolbar></app-toolbar>

<div id="History-Panel">
    <div id="History-Sub-Panel">
        <div class="column-center">
            <div class="column-start-left width-600">
                <!-- <div class="row-start-left-gap-3">
                    <p class="font-bold">History</p>
                </div> -->
                <div class="row-start-left-gap-3">
                    <mat-form-field appearance="outline">
                        <mat-label>Select Date Range</mat-label>
                        <mat-date-range-input [rangePicker]="picker" [formGroup]="range">
                        <input  matStartDate 
                                placeholder="Start Date" 
                                formControlName="start" 
                                [(ngModel)]="fromDate"
                                >
                        <input matEndDate 
                            placeholder="End Date" 
                            formControlName="end"
                            [(ngModel)]="toDate">
                        </mat-date-range-input>
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker (closed)="onClose()"></mat-date-range-picker>
                    </mat-form-field>
                    
                    
                    <mat-radio-group #AuswahlRadio class="tp-radio-group" [(ngModel)]="Auswahl" (change)="AuswahlChanged($event)">
                        <mat-radio-button class="tp-radio-button" [value]="0">Sessions</mat-radio-button>
                        <mat-radio-button class="tp-radio-button" [value]="1">Charts</mat-radio-button>
                    </mat-radio-group>
                    
                    <ng-container *ngIf="(Auswahl === 1)">
                        <mat-radio-group #ChartType class="tp-radio-group" [(ngModel)]="ChartAuswahl" (change)="ChartChanged($event)">
                            <mat-radio-button class="tp-radio-button" [value]="0">Line</mat-radio-button>
                            <mat-radio-button class="tp-radio-button" [value]="1">Bar</mat-radio-button>
                        </mat-radio-group>
                    </ng-container>
                </div>
            </div>        
        </div>


        <div id='history-sessions'>
            <ng-container *ngIf="(Auswahl === 0); then Sessions; else Charts"></ng-container>  
            <ng-template #Sessions>
                <!-- *ngIf="isLoggedIn; then loggedIn; else loggedOut" -->
                <div cdkDropList (cdkDropListDropped)="drop($event)" >
                    <div class="column-center">
                        <div *ngFor="let sess of SessionListe, index as i" cdkDrag [cdkDragDisabled]="true">
                            <div class="row-start-left-gap-3 width-600 height-55 mg-bottom-10">
                                <div class="column-start-left">
                                    <mat-label [ngClass]="{'NoSessionName': NoSessionName(sess) === true }" >{{SessProgrammName(sess)}}</mat-label>
                                    <input class="tc-font-size-smaller width-300" disabled="true" matInput [(ngModel)]="sess.Name" type="text" (click)="$event.stopPropagation()">
                                </div>
                                <div class="column-start-left">
                                    <mat-label>Started at</mat-label>
                                    <input class="tc-font-size-smaller width-200" disabled="true" matInput [ngModel]="GestartedWann(sess)" type="text" (click)="$event.stopPropagation()">
                                </div>
                                
                                <div class="width-100 column-center pad-top-20">
                                    <a [ngClass]="['ml-5','link-button-font', 'HG-01']"  mat-flat-button (click)="ViewSession($event,sess)">View</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
            <ng-template #Charts>
                <div cdkDropList (cdkDropListDropped)="drop($event)">
                    <mat-accordion #accSession="matAccordion" multi="true">
                        <mat-expansion-panel #ExercisesInChart class="HG-01" [expanded]="false">
                            <mat-expansion-panel-header>
                                <div fxLayout="row wrap" fxLayout.lt-sm="row wrap" fxLayoutAlign="flex-start center">
                                    <div class="ml-10 font-14-data" fxLayout="column" fxFlex="155px">
                                        <span>Chart settings</span>
                                    </div>
                                </div>
                            </mat-expansion-panel-header>
                            
                            <div fxLayout="row wrap" fxLayout.lt-sm="row wrap" fxLayoutAlign="flex-start center">
                                <ng-container *ngFor="let DiaUebung of DiaUebungsListe">
                                    <div fxLayout="column" fxLayoutGap="2px" fxFlex="50">
                                        <ng-container *ngIf="DiaUebung.Relevant">
                                            <mat-checkbox [(ngModel)]="DiaUebung.Visible"
                                            (change)="onClickDiaUebung(DiaUebung, $event.checked)">{{DiaUebung.UebungName}}</mat-checkbox>
                                        </ng-container>
                                        
                                    </div>
                                </ng-container>
                            </div>
                            
                            <div fxLayout="row wrap" fxLayout.lt-sm="row wrap" fxLayoutAlign="center center">
                                
                                <div class="center-item" layout-align="center center">
                                    <a [ngClass]="['link-button-font', 'HG-01']" mat-flat-button (click)="Draw(true)">Create charts</a>
                                </div>
                                <div class="center-item" layout-align="center center">
                                    <a [ngClass]="['link-button-font', 'HG-01']" mat-flat-button (click)="Save()">Save</a>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </mat-accordion>
                    
                    <div #ChartContainer class="width-100-Prozent height-80-Prozent">
                        <ng-container *ngIf="(ChartData.length !== undefined && ChartData.length > 0)">
                            <div cdkDropList  (cdkDropListDropped)="drop($event)">
                                <ng-container *ngFor="let mChartData of ChartData; index as i">
                                    <div class="width-100-Prozent">
                                        <div class="mg-top-2">
                                            <mat-accordion #accSession="matAccordion" multi="true"  cdkDrag>
                                                <mat-expansion-panel 
                                                    class="HG-01" 
                                                    (opened)="OnBarChartExpanded(mChartData)"
                                                    (closed)="OnBarChartClosed(mChartData)"
                                                    [expanded]="false">
                                                    <mat-expansion-panel-header mat-tooltip-panel-below  matTooltip="Hold and drag">
                                                        <div fxLayout="row wrap" fxLayout.lt-sm="row wrap"
                                                        fxLayoutAlign="flex-start center">
                                                            <div class="ml-10" fxLayout="column" fxFlex="155px">
                                                                <span>{{mChartData.UebungName}}</span>
                                                            </div>
                                                        </div>
                                                    </mat-expansion-panel-header>
                                    
                                                    <ng-container *ngIf='ChartAuswahl === 0; then linechart; else barchart'></ng-container>
                                                    
                                                    <ng-template #linechart>
                                                        <div class="pad-10 height-500">
                                                            <ngx-charts-line-chart
                                                                #LineChart (window:resize)="onResize(ChartContainer)" 
                                                                height="100vh"   
                                                                [results]="mChartData.LineChartListe" [xAxisLabel]="'Date'" [legendTitle]="'Exercises'" [yAxisLabel]="'Weight'"
                                                                [legend]="false" [showXAxisLabel]="false" [showYAxisLabel]="false" [xAxis]="true" [yAxis]="true"
                                                                [customColors]="mChartData.colors"
                                                                [gradient]="false">
                                                            </ngx-charts-line-chart> 
                                                        </div>
                                                    </ng-template>
                                                    <ng-template #barchart>
                                                        <div class="pad-10 height-500">
                                                            <ngx-charts-bar-vertical #BarChart (window:resize)="onResize(ChartContainer)"
                                                                [height]="100"
                                                                [results]="mChartData.BarChartListe" [xAxisLabel]=""
                                                                [legendTitle]="" [yAxisLabel]="'Weight'" [legend]="false"
                                                                [showXAxisLabel]="false" [showYAxisLabel]="false" [xAxis]="true" [yAxis]="true"
                                                                [customColors]="mChartData.colors" [gradient]="true">
                                                                <ng-template #tooltipTemplate let-model="model">
                                                                    {{ToolTip(mChartData,model)}}
                                                                </ng-template>
                                                            </ngx-charts-bar-vertical>
                                                        </div>
                                                    </ng-template>                                                
                                                    </mat-expansion-panel>
                                                </mat-accordion>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </ng-template>
        </div>
    </div>
<!-- </div> -->

</div>